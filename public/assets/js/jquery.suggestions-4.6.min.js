/**
 * DaData.ru Suggestions jQuery plugin, version 4.6.4
 *
 * DaData.ru Suggestions jQuery plugin is freely distributable under the terms of MIT-style license
 * Built on DevBridge Autocomplete for jQuery (https://github.com/devbridge/jQuery-Autocomplete)
 * For details, see https://github.com/hflabs/suggestions-jquery
 */
!function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){"use strict";function b(c,d){var e=this,f={autoSelectFirst:!1,serviceUrl:null,onInvalidateSelection:a.noop,onSearchStart:a.noop,onSearchComplete:a.noop,onSearchError:a.noop,onSelect:null,onSelectNothing:null,minChars:1,width:"auto",zIndex:9999,maxHeight:300,deferRequestBy:100,params:{},paramName:"query",formatResult:null,delimiter:null,noCache:!1,containerClass:"suggestions-suggestions",tabDisabled:!1,triggerSelectOnSpace:!0,preventBadQueries:!1,usePreloader:!0,hint:b.defaultHint,useDadata:!0,type:null,count:b.defaultCount,constraints:null,restrict_value:!1,$helpers:null};e.element=c,e.el=a(c),e.suggestions=[],e.badQueries=[],e.selectedIndex=-1,e.currentValue=e.element.value,e.intervalId=0,e.cachedResponse={},e.currentRequest=null,e.onChangeTimeout=null,e.$wrapper=null,e.options=a.extend({},f,d),e.classes={hint:"suggestions-hint",selected:"suggestions-selected",suggestion:"suggestions-suggestion",subtext:"suggestions-subtext",subtext_inline:"suggestions-subtext suggestions-subtext_inline",removeConstraint:"suggestions-remove"},e.selection=null,e.$viewport=a(window),e.matchers=[q.matchByNormalizedQuery,q.matchByWords],e.type=null,e.initialize(),e.setOptions(d)}var c={ESC:27,TAB:9,RETURN:13,SPACE:32,UP:38,DOWN:40},d={},e=[],f=[],g=[],h=[],i=[],j=[],k=[],l=".suggestions",m="suggestions",n={OK:0,NO_REGION:1,NO_CITY:2,NO_STREET:3,NO_HOUSE:4,NO_FLAT:5,BAD:6,FOREIGN:7},o='[\\s"-]+',p='[^\\s"-]+',q=function(){var b=0;return{escapeRegExChars:function(a){return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},getDefaultType:function(){return a.support.cors?"POST":"GET"},getDefaultContentType:function(){return a.support.cors?"application/json":"application/x-www-form-urlencoded"},fixURLProtocol:function(b){return a.support.cors?b:b.replace(/^https?:/,location.protocol)},addUrlParams:function(b,c){return b+(/\?/.test(b)?"&":"?")+a.param(c)},serialize:function(b){return a.support.cors?JSON.stringify(b):a.param(b,!0)},compact:function(b){return a.grep(b,function(a){return!!a})},delay:function(a,b){return setTimeout(a,b||0)},uniqueId:function(a){return(a||"")+ ++b},slice:function(a,b){return Array.prototype.slice.call(a,b)},arrayMinus:function(b,c){return a.grep(b,function(b){return-1===a.inArray(b,c)})},getWords:function(a,b){a=a.replace(/(\d+)([\wа-яА-ЯёЁ]{2,})/g,"$1 $2").replace(/([а-яА-ЯёЁ]+)(\d+)/g,"$1 $2");var c=this.compact(a.split(/[.,\s]+/g)),d=c.pop(),e=this.arrayMinus(c,b);return e.push(d),e},normalize:function(a,b){var c=this;return c.getWords(a,b).join(" ")},stringEncloses:function(a,b){return-1!==a.indexOf(b)&&a.length>b.length},haveSameParent:function(b){if(0===b.length)return!1;if(1===b.length)return!0;var c=b[0].value,d=a.grep(b,function(a){return 0===a.value.indexOf(c)},!0);return 0===d.length},matchByNormalizedQuery:function(b,c,d){var e=-1,f=b.toLowerCase(),g=q.normalize(f,d),h=[];return a.each(c,function(a,b){var c=b.value.toLowerCase();return q.stringEncloses(f,c)?!1:c.indexOf(g)>0?!1:void(g===q.normalize(c,d)&&h.push(a))}),1===h.length&&(e=h[0]),e},matchByWords:function(b,c,d){var e=-1,f=b.toLowerCase(),g=q.haveSameParent(c);return g&&a.each(c,function(a,b){var c=b.value.toLowerCase();if(q.stringEncloses(f,c))return!1;var g=q.getWords(f,d),h=q.getWords(c,d);return 0===q.arrayMinus(g,h).length?(e=a,!1):void 0}),e},fieldsNotEmpty:function(b,c){if(!a.isPlainObject(b))return!1;var d=!0;return a.each(c,function(a,c){return d=!!b[c]}),d},checksum:function(a){for(var b=0,c=0;c<a.length;c++){var d=a.charCodeAt(c);b=(b<<5)-b+d,b&=b}return b},formatTimestamp:function(a){function b(a){return 10>a?"0"+a:a}var c=new Date(a);return[b(c.getDate()),b(c.getMonth()+1),c.getFullYear()].join(".")}}}();!function(){d.NAME={STOPWORDS:[],isDataComplete:function(b){var c=this,d=c.options.params,e=a.map(d&&d.parts||["surname","name","patronymic"],function(a){return a.toLowerCase()});return q.fieldsNotEmpty(b,e)},composeValue:function(a){return q.compact([a.surname,a.name,a.patronymic]).join(" ")},urlSuffix:"fio"},d.ADDRESS={STOPWORDS:["ао","аобл","дом","респ","а/я","аал","автодорога","аллея","арбан","аул","б-р","берег","бугор","вал","вл","волость","въезд","высел","г","городок","гск","д","двлд","днп","дор","дп","ж/д_будка","ж/д_казарм","ж/д_оп","ж/д_платф","ж/д_пост","ж/д_рзд","ж/д_ст","жилзона","жилрайон","жт","заезд","заимка","зона","к","казарма","канал","кв","кв-л","км","кольцо","комн","кордон","коса","кп","край","линия","лпх","м","массив","местность","мкр","мост","н/п","наб","нп","обл","округ","остров","оф","п","п/о","п/р","п/ст","парк","пгт","пер","переезд","пл","пл-ка","платф","погост","полустанок","починок","пр-кт","проезд","промзона","просек","просека","проселок","проток","протока","проулок","р-н","рзд","россия","рп","ряды","с","с/а","с/мо","с/о","с/п","с/с","сад","сквер","сл","снт","спуск","ст","ст-ца","стр","тер","тракт","туп","у","ул","уч-к","ф/х","ферма","х","ш","бульвар","владение","выселки","гаражно-строительный","город","деревня","домовладение","дорога","квартал","километр","комната","корпус","литер","леспромхоз","местечко","микрорайон","набережная","область","переулок","платформа","площадка","площадь","поселение","поселок","проспект","разъезд","район","республика","село","сельсовет","слобода","сооружение","станица","станция","строение","территория","тупик","улица","улус","участок","хутор","шоссе"],geoEnabled:!0,isDataComplete:function(a){var b=["house"];return!(!q.fieldsNotEmpty(a,b)||"qc_complete"in a&&a.qc_complete===n.NO_FLAT)},composeValue:function(a){return q.compact([q.compact([a.region,a.region_type]).join(" "),q.compact([a.area_type,a.area]).join(" "),q.compact([a.city_type,a.city]).join(" "),q.compact([a.settlement_type,a.settlement]).join(" "),q.compact([a.street_type,a.street]).join(" "),q.compact([a.house_type,a.house]).join(" "),q.compact([a.block_type,a.block]).join(" "),q.compact([a.flat_type,a.flat]).join(" "),a.postal_box?"а/я "+a.postal_box:null]).join(", ")},urlSuffix:"address"},d.PARTY={STOPWORDS:[],isDataComplete:function(){return!0},enrichServiceName:"default",urlSuffix:"party",formatResult:function(a,b,c){var d=this,a=d.formatResult(a,b,c);if(c.data&&c.data.state&&c.data.state.registration_date&&(a+='<span class="'+d.classes.subtext_inline+'">'+q.formatTimestamp(c.data.state.registration_date),c.data.state.liquidation_date&&(a+=" &ndash; "+q.formatTimestamp(c.data.state.liquidation_date)),a+="</span>"),c.data&&c.data.address&&c.data.address.value){var e=c.data.address.value.replace(/^\d{6}( РОССИЯ)?, /i,"");a+='<div class="'+d.classes.subtext+'">'+d.formatResult(e,b,c)+"</div>"}return a}}}();var r={suggest:{defaultParams:{type:q.getDefaultType(),dataType:"json",contentType:q.getDefaultContentType()},addTypeInUrl:!0},detectAddressByIp:{defaultParams:{type:"GET",dataType:"json"},addTypeInUrl:!1}};b.utils=q,b.defaultHint="Выберите вариант ниже или продолжите ввод",b.defaultCount=10,b.version="4.6.4",a.Suggestions=b,b.prototype={initialize:function(){var a=this;a.element.setAttribute("autocomplete","off"),this.el.addClass("suggestions-input").css("box-sizing","border-box"),a.uniqueId=q.uniqueId("i"),a.createWrapper(),a.applyHooks(e),a.bindWindowEvents(),a.fixPosition()},dispose:function(){var a=this;a.applyHooks(f),a.el.removeData(m).removeClass("suggestions-input"),a.unbindWindowEvents(),a.removeWrapper()},applyHooks:function(b){var c=this,d=q.slice(arguments,1);return a.map(b,function(a){return a.apply(c,d)})},createWrapper:function(){var b=this;b.$wrapper=a('<div class="suggestions-wrapper"/>'),b.el.after(b.$wrapper),b.$wrapper.add(b.options.$helpers).on("mousedown"+l,a.proxy(b.onMousedown,b))},removeWrapper:function(){this.$wrapper.remove()},onMousedown:function(b){var c=this;b.preventDefault(),c.cancelBlur=!0,q.delay(function(){delete c.cancelBlur}),a(b.target).closest(".ui-menu-item").length||q.delay(function(){a(document).one("mousedown",function(b){var d=c.el.add(c.$wrapper).add(c.options.$helpers);d=d.filter(function(){return this===b.target||a.contains(this,b.target)}),d.length||c.hide()})})},bindWindowEvents:function(){var b=this;b.$viewport.on("resize"+l+b.uniqueId,a.proxy(b.fixPosition,b))},unbindWindowEvents:function(){this.$viewport.off("resize"+l+this.uniqueId)},setOptions:function(b){var c=this;if(a.extend(c.options,b),c.type=d[c.options.type],!c.type)throw c.disable(),"`type` option is incorrect! Must be one of: "+a.map(d,function(a,b){return'"'+b+'"'}).join(", ");c.applyHooks(g)},fixPosition:function(){var a,b,c,d=this,e={};d.applyHooks(i),d.el.css("paddingLeft",""),d.el.css("paddingRight",""),e.paddingLeft=parseFloat(d.el.css("paddingLeft")),e.paddingRight=parseFloat(d.el.css("paddingRight")),a=d.el.offset(),e.borderTop="none"==d.el.css("border-top-style")?0:parseFloat(d.el.css("border-top-width")),e.borderLeft="none"==d.el.css("border-left-style")?0:parseFloat(d.el.css("border-left-width")),e.innerHeight=d.el.innerHeight(),e.innerWidth=d.el.innerWidth(),b=d.$wrapper.offset(),c={top:a.top-b.top,left:a.left-b.left},d.applyHooks(h,c,e),d.el.css("paddingLeft",e.paddingLeft+"px")},clearCache:function(){this.cachedResponse={},this.badQueries=[]},clear:function(){this.clearCache(),this.currentValue="",this.selection=null,this.suggestions=[]},disable:function(){var a=this;a.disabled=!0,a.abortRequest(),a.hide()},enable:function(){this.disabled=!1},update:function(){var a=this,b=a.el.val(),c=a.getQuery(b);c.length>=a.options.minChars?a.updateSuggestions(c):a.hide()},setSuggestion:function(b){var c=this;a.isPlainObject(b)&&b.value&&(c.currentValue=b.value,c.el.val(b.value),c.selection=b,c.abortRequest())},getAjaxParams:function(c,d){var e=this,f=a.trim(e.options.token),g=e.options.serviceUrl,h=r[c],i=a.extend({},h.defaultParams),j={};return/\/$/.test(g)||(g+="/"),g+=c,h.addTypeInUrl&&(g+="/"+e.type.urlSuffix),g=q.fixURLProtocol(g),a.support.cors?(f&&(j.Authorization="Token "+f),j["X-Version"]=b.version,i.headers=a.extend(i.headers||{},j)):(f&&(j.token=f),j.version=b.version,g=q.addUrlParams(g,j)),i.url=g,a.extend(i,d)},getQuery:function(b){var c,d=this.options.delimiter;return d?(c=b.split(d),a.trim(c[c.length-1])):b},constructRequestParams:function(b,c){var d=this,e=d.options,f=a.isFunction(e.params)?e.params.call(d.element,b):a.extend({},e.params);return a.each(d.applyHooks(j),function(b,c){a.extend(f,c)}),f[e.paramName]=b,a.isNumeric(e.count)&&e.count>0&&(f.count=e.count),a.extend(f,c)},updateSuggestions:function(a){var b=this;b.getSuggestions(a).done(function(c){b.assignSuggestions(c,a)})},getSuggestions:function(b,c,d){var e,f=this,g=f.options,h=g.serviceUrl,i=f.constructRequestParams(b,c),j=h+"?"+a.param(i||{}),k=a.Deferred(),l=d&&d.noCallbacks;return e=f.cachedResponse[j],e&&a.isArray(e.suggestions)?k.resolve(e.suggestions):f.isBadQuery(b)?k.reject():l||g.onSearchStart.call(f.element,i)!==!1?(f.abortRequest(),f.showPreloader(),f.currentRequest=f.doGetSuggestions(i),f.currentRequest.always(function(){f.currentRequest=null,f.hidePreloader()}).done(function(a){f.processResponse(a,b,j)?k.resolve(a.suggestions):k.reject(),l||g.onSearchComplete.call(f.element,b,a.suggestions)}).fail(function(a,c,d){k.reject(),l||g.onSearchError.call(f.element,b,a,c,d)})):k.reject(),k},doGetSuggestions:function(b){var c=this;return a.ajax(c.getAjaxParams("suggest",{data:q.serialize(b)}))},isBadQuery:function(b){if(!this.options.preventBadQueries)return!1;var c=!1;return a.each(this.badQueries,function(a,d){return!(c=0===b.indexOf(d))}),c},abortRequest:function(){var a=this;a.currentRequest&&a.currentRequest.abort()},processResponse:function(b,c,d){var e=this,f=e.options;return b&&a.isArray(b.suggestions)?(e.verifySuggestionsFormat(b.suggestions),e.setUnrestrictedValues(b.suggestions),f.noCache||(e.cachedResponse[d]=b,f.preventBadQueries&&0===b.suggestions.length&&e.badQueries.push(c)),c!==e.getQuery(e.currentValue)?!1:!0):!1},verifySuggestionsFormat:function(b){"string"==typeof b[0]&&a.each(b,function(a,c){b[a]={value:c,data:null}})},assignSuggestions:function(a,b){var c=this;c.suggestions=a,c.applyHooks(k,b)},getValue:function(a){var b,c,d=this,e=d.options.delimiter;return e?(b=d.currentValue,c=b.split(e),1===c.length?a:b.substr(0,b.length-c[c.length-1].length)+a):a},shouldRestrictValues:function(){var a=this;return a.options.restrict_value&&a.constraints&&1==Object.keys(a.constraints).length},setUnrestrictedValues:function(b){var c=this,d=c.shouldRestrictValues(),e=c.getConstraintLabel();a.each(b,function(a,b){b.unrestricted_value=d?e+", "+b.value:b.value})},findSuggestionIndex:function(b){var c=this,d=-1,e=c.type.STOPWORDS||[];return""!==a.trim(b)&&a.each(c.matchers,function(a,f){return d=f(b,c.suggestions,e),-1===d}),d}},function(){var d={bindElementEvents:function(){var b=this;b.el.on("keydown"+l,a.proxy(b.onElementKeyDown,b)),b.el.on(["keyup"+l,"cut"+l,"paste"+l].join(" "),a.proxy(b.onElementKeyUp,b)),b.el.on("blur"+l,a.proxy(b.onElementBlur,b)),b.el.on("focus"+l,a.proxy(b.onElementFocus,b))},unbindElementEvents:function(){this.el.off(l)},onElementBlur:function(){var a=this;return a.cancelBlur?void delete a.cancelBlur:(a.selectCurrentValue({trim:!0,noSpace:!0}),void a.abortRequest())},onElementFocus:function(){var a=this;a.cancelFocus||(a.fixPosition(),a.update()),a.cancelFocus=!1},onElementKeyDown:function(a){var b=this;if(!b.disabled)if(b._waitingForTriggerSelectOnSpace=!1,b.visible){switch(a.which){case c.ESC:b.el.val(b.currentValue),b.hide(),b.abortRequest();break;case c.TAB:if(b.options.tabDisabled===!1)return;break;case c.RETURN:b.selectCurrentValue({trim:!0});break;case c.SPACE:if(b.options.triggerSelectOnSpace&&b.isCursorAtEnd()){var d=-1!==b.selectCurrentValue({continueSelecting:!0,noSpace:!0});b._waitingForTriggerSelectOnSpace=!d,b.cancelKeyUp=d}return;case c.UP:b.moveUp();break;case c.DOWN:b.moveDown();break;default:return}a.stopImmediatePropagation(),a.preventDefault()}else switch(a.which){case c.DOWN:b.suggest();break;case c.RETURN:b.triggerOnSelectNothing();break;case c.SPACE:b._waitingForTriggerSelectOnSpace=!0}},onElementKeyUp:function(a){var b=this;if(b.disabled||b.cancelKeyUp)return void(b.cancelKeyUp=!1);switch(a.which){case c.UP:case c.DOWN:return}clearTimeout(b.onChangeTimeout),b.currentValue!==b.el.val()&&(b.options.deferRequestBy>0?b.onChangeTimeout=q.delay(function(){b.onValueChange()},b.options.deferRequestBy):b.onValueChange())},onValueChange:function(){var b=this,c=b.options,d=b.el.val();b.selection&&((c.onInvalidateSelection||a.noop).call(b.element,b.selection),b.selection=null),clearTimeout(b.onChangeTimeout),b.currentValue=d,b.selectedIndex=-1,b.update()},isCursorAtEnd:function(){var a,b=this,c=b.el.val().length,d=b.element.selectionStart;return"number"==typeof d?d===c:document.selection?(a=document.selection.createRange(),a.moveStart("character",-c),c===a.text.length):!0}};a.extend(b.prototype,d),e.push(d.bindElementEvents),f.push(d.unbindElementEvents)}(),function(){var c={},d={checkToken:function(){function b(){d.checkToken()}var d=this,e=a.trim(d.options.token),f=c[e];if(e)if(f&&a.isFunction(f.promise))switch(f.state()){case"resolved":d.enable();break;case"rejected":d.disable();break;default:f.always(b)}else(c[e]=a.ajax(d.getAjaxParams("suggest"))).always(b)}};b.resetTokens=function(){c={}},a.extend(b.prototype,d),g.push(d.checkToken)}(),function(){if("GET"!=q.getDefaultType()){var c,d={checkLocation:function(){var b=this;b.type.geoEnabled&&null==b.options.constraints&&(c||(c=a.ajax(b.getAjaxParams("detectAddressByIp"))),c.done(function(a){var c=a&&a.location&&a.location.data;c&&c.kladr_id&&b.enableGeolocation(c)}))},enableGeolocation:function(a){var b=this,c=b.formatConstraint({deletable:!0,locations:a});c.locations=[{region:a.region,area:a.area,city:a.city,settlement:a.settlement,kladr_id:a.kladr_id}],b.setupConstraints(c),b.options.restrict_value=!0}};a.extend(b.prototype,d),g.push(d.checkLocation)}}(),function(){var b={"default":{enrichSuggestion:function(b){return a.Deferred().resolve(b)}},dadata:function(){return{enrichSuggestion:function(b){function c(a){return a&&a.data&&a.data.hasOwnProperty("qc")&&null!==a.data.qc}var d=this,e=a.Deferred();return b.data&&null!=b.data.qc?e.resolve(b):(d.disableDropdown(),d.getSuggestions(b.value,{count:1},{noCallbacks:!0}).always(function(){d.enableDropdown()}).done(function(a){var d=a[0];e.resolve(c(d)?d:b)}).fail(function(){e.resolve(b)}),e)}}}()},c={selectEnrichService:function(){var c=this,e=c.options.type,f=a.trim(c.options.token);c.enrichService=c.options.useDadata&&e&&d[e]&&f?b[d[e].enrichServiceName||"dadata"]:b["default"]}};g.push(c.selectEnrichService)}(),function(){var c={createContainer:function(){var b=this,c="."+b.classes.suggestion,d=b.options,e=a("<div/>").addClass(d.containerClass).css({position:"absolute",display:"none"});b.$container=e,b.$wrapper.append(e),"auto"!==d.width&&e.width(d.width),e.on("mouseover"+l,c,a.proxy(b.onSuggestionMouseover,b)),e.on("click"+l,c,a.proxy(b.onSuggestionClick,b)),e.on("mouseout"+l,a.proxy(b.onSuggestionsMouseout,b))},applyContainerOptions:function(){var a=this,b=a.options;a.$container.css({"max-height":b.maxHeight+"px","z-index":b.zIndex,width:b.width})},onSuggestionMouseover:function(a){this.activate(this.getClosestSuggestionIndex(a.target))},onSuggestionClick:function(a){var b=this;b.dropdownDisabled||b.select(b.getClosestSuggestionIndex(a.target)),b.cancelFocus=!0,b.el.focus()},onSuggestionsMouseout:function(){this.deactivate(!1)},setDropdownPosition:function(a,b){var c=this;c.$container.css({left:a.left+"px",top:a.top+b.borderTop+b.innerHeight+"px",width:("auto"===c.options.width?c.el.outerWidth():c.options.width)+"px"})},getClosestSuggestionIndex:function(b){var c=this,d=a(b),e="."+c.classes.suggestion+"[data-index]";return d.is(e)||(d=d.closest(e)),d.data("index")},getSuggestionsItems:function(){return this.$container.children("."+this.classes.suggestion)},toggleDropdownEnabling:function(a){this.dropdownDisabled=!a,this.$container.attr("disabled",!a)},disableDropdown:function(){this.toggleDropdownEnabling(!1)},enableDropdown:function(){this.toggleDropdownEnabling(!0)},hasSuggestionsToChoose:function(){var b=this;return b.suggestions.length>1||1===b.suggestions.length&&(!b.selection||a.trim(b.suggestions[0].value)!=a.trim(b.selection.value))},suggest:function(){if(!this.hasSuggestionsToChoose())return void this.hide();var b=this,c=b.options,d=c.formatResult||b.type.formatResult||b.formatResult,e=a.trim(b.getQuery(b.currentValue)),f=c.beforeRender,g=[];c.hint&&b.suggestions.length&&g.push('<div class="'+b.classes.hint+'">'+c.hint+"</div>"),b.selectedIndex=-1,a.each(b.suggestions,function(a,c){c==b.selection&&(b.selectedIndex=a),g.push('<div class="'+b.classes.suggestion+'" data-index="'+a+'">'+d.call(b,c.value,e,c)+"</div>")}),b.$container.html(g.join("")),c.autoSelectFirst&&-1===b.selectedIndex&&(b.selectedIndex=0),-1!==b.selectedIndex&&b.getSuggestionsItems().eq(b.selectedIndex).addClass(b.classes.selected),a.isFunction(f)&&f.call(b.element,b.$container),b.$container.show(),b.visible=!0},formatResult:function(b,c){var d=c.split(/\s+/g);return a.each(d,function(a,c){b=b.replace(new RegExp("(^|"+o+")("+q.escapeRegExChars(c)+")("+o+"|$)","gi"),"$1<strong>$2</strong>$3")}),a.each(d.reverse(),function(a,c){b=b.replace(new RegExp("(^|"+o+")("+q.escapeRegExChars(c)+")("+p+")","gi"),"$1<strong>$2</strong>$3")}),b},hide:function(){var a=this;a.visible=!1,a.selectedIndex=-1,a.$container.hide().empty()},activate:function(b){var c,d,e=this,f=e.classes.selected;return!e.dropdownDisabled&&(d=e.getSuggestionsItems(),d.removeClass(f),e.selectedIndex=b,-1!==e.selectedIndex&&d.length>e.selectedIndex)?(c=d.get(e.selectedIndex),a(c).addClass(f),c):null},deactivate:function(a){var b=this;b.dropdownDisabled||(b.selectedIndex=-1,b.getSuggestionsItems().removeClass(b.classes.selected),a&&b.el.val(b.currentValue))},moveUp:function(){var a=this;if(!a.dropdownDisabled)return-1===a.selectedIndex?void(a.suggestions.length&&a.adjustScroll(a.suggestions.length-1)):0===a.selectedIndex?void a.deactivate(!0):void a.adjustScroll(a.selectedIndex-1)},moveDown:function(){var a=this;if(!a.dropdownDisabled)return a.selectedIndex===a.suggestions.length-1?void a.deactivate(!0):void a.adjustScroll(a.selectedIndex+1)},adjustScroll:function(a){var b,c,d,e=this,f=e.activate(a),g=25;f&&(b=f.offsetTop,c=e.$container.scrollTop(),d=c+e.options.maxHeight-g,c>b?e.$container.scrollTop(b):b>d&&e.$container.scrollTop(b-e.options.maxHeight+g),e.el.val(e.getValue(e.suggestions[a].value)))}};a.extend(b.prototype,c),e.push(c.createContainer),g.push(c.applyContainerOptions),h.push(c.setDropdownPosition),k.push(c.suggest)}(),function(){var c="preloader",d=50,f=1e3,g={createPreloader:function(){var b=this,c=a('<i class="suggestions-preloader"/>').appendTo(b.$wrapper);b.preloader={$el:c,visibleCount:0,height:c.height(),width:c.width(),initialPadding:null}},setPreloaderPosition:function(a,b){var c=this;c.preloader.$el.css({left:a.left+b.borderLeft+b.innerWidth-c.preloader.width-b.paddingRight+"px",top:a.top+b.borderTop+Math.round((b.innerHeight-c.preloader.height)/2)+"px"}),c.preloader.initialPadding=b.paddingRight},showPreloader:function(){var b=this;b.options.usePreloader&&(b.preloader.visibleCount++||b.preloader.$el.stop(!0,!0).delay(d).queue(function(){b.showPreloaderBackground(),a(this).dequeue()}).animate({opacity:1},"fast"))},hidePreloader:function(){var a=this;a.options.usePreloader&&(--a.preloader.visibleCount||a.preloader.$el.stop(!0).animate({opacity:0},{duration:"fast",complete:function(){a.hidePreloaderBackground()}}))},showPreloaderBackground:function(){var a=this,b=4;a.el.stop(c,!0).animate({"padding-right":a.preloader.initialPadding+a.preloader.width+b},{duration:"fast",queue:c}).dequeue(c)},hidePreloaderBackground:function(){var a=this;a.el.stop(c,!0,!0).delay(f,c).animate({"padding-right":a.preloader.initialPadding},{duration:"fast",queue:c}).dequeue(c)},stopPreloaderBackground:function(){this.el.stop(c,!0)}};a.extend(b.prototype,g),e.push(g.createPreloader),h.push(g.setPreloaderPosition),i.push(g.stopPreloaderBackground)}(),function(){var c={createConstraints:function(){var b=this;b.constraints={},b.$constraints=a('<ul class="suggestions-constraints"/>'),b.$wrapper.append(b.$constraints),b.$constraints.on("click","."+b.classes.removeConstraint,a.proxy(b.onConstraintRemoveClick,b))},setConstraintsPosition:function(a,b){var c=this;c.$constraints.css({left:a.left+b.borderLeft+b.paddingLeft+"px",top:a.top+b.borderTop+Math.round((b.innerHeight-c.$constraints.height())/2)+"px"}),b.paddingLeft+=c.$constraints.outerWidth(!0)},onConstraintRemoveClick:function(b){var c=this,d=a(b.target).closest("li"),e=d.attr("data-constraint-id");delete c.constraints[e],c.update(),d.fadeOut("fast",function(){c.removeConstraint(e)})},setupConstraints:function(b){var c=this,d=c.options.constraints;d!==!1&&(d||(d=b))&&(c._constraintsUpdating=!0,a.each(c.constraints,a.proxy(c.removeConstraint,c)),a.each(a.makeArray(d),function(a,b){c.addConstraint(b)}),c._constraintsUpdating=!1,c.fixPosition())},formatConstraint:function(b){var c=this;return b&&(b.locations||b.restrictions)?(b.locations=a.makeArray(b.locations||b.restrictions),b.label||(b.label=a.map(b.locations,function(a){return c.type.composeValue(a)}).join(", ")),b):void 0},addConstraint:function(b){var c,d,e=this;b=e.formatConstraint(b),b&&(d=q.uniqueId("c"),e.constraints[d]=b,c=a("<li/>").append(a("<span/>").text(b.label)).attr("data-constraint-id",d),b.deletable&&c.append(a('<span class="suggestions-remove"/>')),e.$constraints.append(c),e._constraintsUpdating||e.fixPosition())},removeConstraint:function(a){var b=this;delete b.constraints[a],b.$constraints.children('[data-constraint-id="'+a+'"]').remove(),b._constraintsUpdating||b.fixPosition()},constructConstraintsParams:function(){var b=this,c=[],d={};return a.each(b.constraints,function(a,b){c=c.concat(b.locations)}),c.length&&(d.locations=c,d.restrict_value=b.options.restrict_value),d},getConstraintLabel:function(){var a=this,b=a.constraints&&Object.keys(a.constraints)[0];return b?a.constraints[b].label:""}};a.extend(b.prototype,c),"GET"!=q.getDefaultType()&&(e.push(c.createConstraints),g.push(c.setupConstraints),h.push(c.setConstraintsPosition),j.push(c.constructConstraintsParams))}(),function(){var c={proceedQuery:function(a){var b=this;a.length>=b.options.minChars?b.updateSuggestions(a):b.hide()},selectCurrentValue:function(b){var c=this,d=c.selectedIndex,e=b&&b.trim;if(-1===d){var f=c.getQuery(c.el.val());e&&(f=a.trim(f)),d=c.findSuggestionIndex(f)}return c.select(d,b),d},select:function(a,b){function c(){f?(d.selectedIndex=-1,d.updateSuggestions(d.currentValue)):d.hide()}var d=this,e=d.suggestions[a],f=b&&b.continueSelecting,g=b&&b.noSpace,h=b&&b.addSpace;return e?(d.currentValue=d.getValue(e.value),d.el.val(d.currentValue),void d.enrichService.enrichSuggestion.call(d,e).done(function(a){var b=d.type.isDataComplete.call(d,a.data);b&&(f=!1),(!g&&!b||h)&&(d.currentValue+=" ",d.el.val(d.currentValue)),d.selection=a,d.triggerOnSelect(a),c()})):(f||d.selection||d.triggerOnSelectNothing(),void c())},triggerOnSelect:function(b){var c=this,d=c.options.onSelect;a.isFunction(d)&&d.call(c.element,b)},triggerOnSelectNothing:function(){var b=this,c=b.options.onSelectNothing;a.isFunction(c)&&c.call(b.element,b.currentValue)},trySelectOnSpace:function(b){var c,d=this,e=/\s$/;d.options.triggerSelectOnSpace&&d._waitingForTriggerSelectOnSpace&&e.test(b)&&(c=d.findSuggestionIndex(a.trim(b)),-1!==c&&(d._waitingForTriggerSelectOnSpace=!1,d.select(c,{continueSelecting:!0,addSpace:!0})))}};a.extend(b.prototype,c),k.push(c.trySelectOnSpace)}(),a.fn.suggestions=function(c,d){return 0===arguments.length?this.first().data(m):this.each(function(){var e=a(this),f=e.data(m);"string"==typeof c?f&&"function"==typeof f[c]&&f[c](d):(f&&f.dispose&&f.dispose(),f=new b(this,c),e.data(m,f))})}});